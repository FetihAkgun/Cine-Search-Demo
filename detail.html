<!DOCTYPE html>
<html data-theme="dark" lang="tr">
   <head>
      <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta http-equiv="Permissions-Policy" content="autoplay=(self), encrypted-media=(self), accelerometer=(self), gyroscope=(self), picture-in-picture=(self), clipboard-write=(self), web-share=(self)"/>
    <meta name="referrer" content="strict-origin-when-cross-origin"/>
    <meta name="description" content="Film ve dizi detay sayfasÄ±. Oyuncular, fragman, gÃ¶rseller ve daha fazlasÄ±."/>
    <meta name="keywords" content="film detay, dizi detay, sinema, oyuncular"/>
    <meta name="robots" content="index, follow"/>
    <link rel="canonical" href="https://cinesearch.fetihakgun.com/detail.html"/>
    <meta property="og:type" content="video.movie"/>
    <meta property="og:title" content="Cine Search - Detay"/>
    <meta property="og:description" content="Film ve dizi detay sayfasÄ±. Oyuncular, fragman, gÃ¶rseller ve daha fazlasÄ±."/>
    <meta property="og:url" content="https://cinesearch.fetihakgun.com/detail.html"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Cine Search - Detay"/>
    <meta name="twitter:description" content="Film ve dizi detay sayfasÄ±. Oyuncular, fragman, gÃ¶rseller ve daha fazlasÄ±."/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
      <link href="/main.css" rel="stylesheet" type="text/css"/>
    <script src="/app.js" defer></script>
    <title>Cine Search - Detay</title>
   </head>
   <body>
    <!-- Navigation -->
    <nav class="navbar" id="mainNav">
        <div class="nav-container">
            <a class="navbar-brand" href="/index.html">
                <span class="brand-text">Cine Search</span>
            </a>
            <div class="navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                           <li class="nav-item">
                        <a class="nav-link" href="/index.html" data-translate="movies">Filmler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/diziler.html" data-translate="series">Diziler</a>
                           </li>
                        </ul>
                <div class="nav-controls">
                    <button class="theme-toggle" type="button" title="Toggle Theme">
                        <i class="fas fa-moon theme-icon"></i>
                    </button>
                    <div class="language-selector">
                        <select>
                            <option value="tr">TR</option>
                            <option value="en">EN</option>
                        </select>
                    </div>
                        </div>
                     </div>
                  </div>
               </nav>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-bottom-nav">
        <div class="mobile-bottom-nav-items">
            <a href="/index.html" class="mobile-bottom-nav-item">
                <i class="fas fa-home"></i>
                <span data-translate="movies">Filmler</span>
            </a>
            <a href="/diziler.html" class="mobile-bottom-nav-item">
                <i class="fas fa-tv"></i>
                <span data-translate="series">Diziler</span>
            </a>
            <button class="mobile-bottom-nav-item mobile-nav-control" type="button" id="mobileSearchButton">
                <i class="fas fa-search"></i>
                <span data-translate="search">Ara</span>
            </button>
            <button class="mobile-bottom-nav-item mobile-nav-control" type="button" id="mobileThemeToggle" title="Toggle Theme">
                <i class="fas fa-moon theme-icon"></i>
                <span data-translate="theme">Tema</span>
            </button>
            <div class="mobile-bottom-nav-item mobile-nav-control mobile-language-item">
                <div class="mobile-language-button" id="mobileLanguageButton">
                    <span id="mobileLanguageText">TR</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="mobile-language-dropdown" id="mobileLanguageDropdown">
                    <div class="mobile-language-option" data-lang="tr">TR</div>
                    <div class="mobile-language-option" data-lang="en">EN</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Search Modal -->
    <div class="mobile-search-modal" id="mobileSearchModal">
        <div class="mobile-search-overlay" id="mobileSearchOverlay"></div>
        <div class="mobile-search-container">
            <div class="mobile-search-header">
                <h3 data-translate="search">Ara</h3>
                <button class="mobile-search-close" id="mobileSearchClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="mobile-search-form" id="mobileSearchForm">
                <div class="mobile-search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="search" class="mobile-search-input" id="mobileSearchInput" data-translate-placeholder="searchPlaceholder" placeholder="Film Ara" autofocus/>
                </div>
                <div class="mobile-search-type-selector">
                    <label class="mobile-search-type-option">
                        <input type="radio" name="searchType" value="movie" checked/>
                        <span data-translate="movies">Filmler</span>
                    </label>
                    <label class="mobile-search-type-option">
                        <input type="radio" name="searchType" value="tv"/>
                        <span data-translate="series">Diziler</span>
                    </label>
                </div>
                <button type="submit" class="mobile-search-submit">
                    <i class="fas fa-search"></i>
                    <span data-translate="search">Ara</span>
                </button>
            </form>
                     </div>
                           </div>

    <!-- Detail Hero Section -->
    <div class="detail-hero" id="detailHero">
        <!-- Mobile Back Button -->
        <button class="mobile-back-button" id="mobileBackButton" aria-label="Geri">
            <i class="fas fa-arrow-left"></i>
        </button>
        <div class="detail-backdrop" id="detailBackdrop"></div>
        <div class="detail-content">
            <div class="detail-header">
                <div class="detail-poster-wrapper">
                    <img class="detail-poster" id="detailPoster" src="" alt="Poster" style="display: none;">
                           </div>
                <div class="detail-info-wrapper">
                    <h1 class="detail-title" id="detailTitle">YÃ¼kleniyor...</h1>
                    <div class="detail-meta" id="detailMeta"></div>
                    <div class="detail-genres" id="detailGenres"></div>
                    <p class="detail-description" id="detailDescription"></p>
                        </div>
                     </div>
                  </div>
               </div>

    <!-- Video Section -->
    <div class="content-section">
        <div class="video-container" id="videoContainer">
            <iframe id="videoFrame" style="display: none;" width="100%" height="100%" src="" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen loading="lazy"></iframe>
            <div class="video-placeholder" id="videoPlaceholder" style="display: none;">
                <i class="fas fa-video-slash"></i>
                <p id="videoPlaceholderText">Video yÃ¼kleniyor...</p>
            </div>
               </div>
            </div>

    <!-- Cast Section -->
    <div class="content-section">
        <div class="cast-section">
            <h2 class="row-title" data-translate="actors">OYUNCULAR</h2>
            <div class="cast-grid" id="castGrid">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
               </div>
            </div>
        </div>
               </div>

    <!-- Gallery Section -->
    <div class="content-section">
        <h2 class="row-title" data-translate="gallery">GALERÄ°</h2>
        <div class="gallery" id="gallery">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
            </div>
        </div>
    </div>

    <!-- Similar Section -->
    <div class="content-section">
        <div class="similar-section fade-in">
            <h2 class="row-title" data-translate="recommendations">Ã–NERÄ°LEN FÄ°LMLER</h2>
            <div class="movies-row" id="similarMovies">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
               </div>
            </div>
         </div>
      </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>
      <script>
        const API_KEY = '1b44088d28f43962ed16e614f60cbbd1';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';
        const BACKDROP_BASE = 'https://image.tmdb.org/t/p/original';
        
        function createSlug(title) {
            if (!title) return '';
            return title
                .toLowerCase()
                .replace(/ÄŸ/g, 'g')
                .replace(/Ã¼/g, 'u')
                .replace(/ÅŸ/g, 's')
                .replace(/Ä±/g, 'i')
                .replace(/Ã¶/g, 'o')
                .replace(/Ã§/g, 'c')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }
        
        function createDetailUrl(id, type, title) {
            const slug = createSlug(title);
            const typePath = type === 'movie' ? 'film' : 'dizi';
            return `${typePath}/${id}${slug ? '-' + slug : ''}`;
        }
        
        // Get API language from language manager
        function getApiLanguage() {
            return window.languageManager ? window.languageManager.getApiLanguage() : 'tr-TR';
        }

        function getPageNumberFromURL(variable) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(variable) || '';
        }
        
        function parseUrlForId() {
            const path = window.location.pathname;
            const filmMatch = path.match(/\/film\/(\d+)/);
            const diziMatch = path.match(/\/dizi\/(\d+)/);
            
            if (filmMatch) {
                return { id: filmMatch[1], type: 'movie' };
            } else if (diziMatch) {
                return { id: diziMatch[1], type: 'tv' };
            } else {
                const urlParams = new URLSearchParams(window.location.search);
                return {
                    id: urlParams.get('id') || '',
                    type: urlParams.get('type') || 'movie'
                };
            }
        }
        
        function updateSEOMetaTags(data, type) {
            const title = data.title || data.name || 'Film/Dizi';
            const description = data.overview || 'Film ve dizi detay sayfasÄ±';
            const imageUrl = data.poster_path ? `${IMAGE_BASE}${data.poster_path}` : '';
            const currentUrl = window.location.href;
            const ogType = type === 'movie' ? 'video.movie' : 'video.tv_show';
            
            document.title = `${title} - Cine Search`;
            
            const metaDescription = document.querySelector('meta[name="description"]');
            if (metaDescription) metaDescription.content = description.substring(0, 160);
            
            const ogTitle = document.querySelector('meta[property="og:title"]');
            if (ogTitle) ogTitle.content = title;
            
            const ogDescription = document.querySelector('meta[property="og:description"]');
            if (ogDescription) ogDescription.content = description.substring(0, 200);
            
            const ogUrl = document.querySelector('meta[property="og:url"]');
            if (ogUrl) ogUrl.content = currentUrl;
            
            const ogTypeMeta = document.querySelector('meta[property="og:type"]');
            if (ogTypeMeta) ogTypeMeta.content = ogType;
            
            if (imageUrl) {
                let ogImage = document.querySelector('meta[property="og:image"]');
                if (!ogImage) {
                    ogImage = document.createElement('meta');
                    ogImage.setAttribute('property', 'og:image');
                    document.head.appendChild(ogImage);
                }
                ogImage.content = imageUrl;
            }
            
            const twitterTitle = document.querySelector('meta[name="twitter:title"]');
            if (twitterTitle) twitterTitle.content = title;
            
            const twitterDescription = document.querySelector('meta[name="twitter:description"]');
            if (twitterDescription) twitterDescription.content = description.substring(0, 200);
            
            if (imageUrl) {
                let twitterImage = document.querySelector('meta[name="twitter:image"]');
                if (!twitterImage) {
                    twitterImage = document.createElement('meta');
                    twitterImage.setAttribute('name', 'twitter:image');
                    document.head.appendChild(twitterImage);
                }
                twitterImage.content = imageUrl;
            }
            
            const canonical = document.querySelector('link[rel="canonical"]');
            if (canonical) canonical.href = currentUrl;
            
            const structuredData = {
                "@context": "https://schema.org",
                "@type": type === 'movie' ? "Movie" : "TVSeries",
                "name": title,
                "description": description,
                "image": imageUrl,
                "url": currentUrl
            };
            
            if (data.vote_average) {
                structuredData.aggregateRating = {
                    "@type": "AggregateRating",
                    "ratingValue": data.vote_average / 2,
                    "bestRating": "5",
                    "worstRating": "1",
                    "ratingCount": data.vote_count || 0
                };
            }
            
            let existingScript = document.querySelector('script[type="application/ld+json"]');
            if (existingScript) {
                existingScript.textContent = JSON.stringify(structuredData);
            } else {
                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.textContent = JSON.stringify(structuredData);
                document.head.appendChild(script);
            }
        }
        
        // Reload page content when language changes
        function reloadPageContent(lang, apiLang) {
            const urlData = parseUrlForId();
            const movieId = urlData.id;
            const type = urlData.type;
            
            if (movieId) {
                // Reload all content with new language
                getFilmDetails(movieId, type);
                getFilmfragman(movieId, type);
                getOyuncular(movieId, type);
                getFilmImages(movieId, type);
                getBenzerFilm(movieId, type);
            }
        }

        function fillStars(rating) {
            const stars = document.querySelectorAll('.rating-stars .star');
            const value = Math.round(rating);
            stars.forEach((star, index) => {
                if (index < value) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
        }

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('mainNav');
            if (window.scrollY > 50) {
                nav.classList.add('scrolled');
            } else {
                nav.classList.remove('scrolled');
            }
        });

        async function getFilmDetails(movieId, type) {
            try {
                if (!movieId || !type) {
                    throw new Error('Film ID veya tip bilgisi eksik');
                }
                
                const apiLang = getApiLanguage();
                const response = await fetch(`${BASE_URL}/${type}/${movieId}?api_key=${API_KEY}&language=${apiLang}`);
                if (!response.ok) {
                    throw new Error(`Film bilgileri alÄ±namadÄ±: ${response.status}`);
                }
                
                        const data = await response.json();
         
                if (!data) {
                    throw new Error('Film verisi boÅŸ');
                }
                
                updateSEOMetaTags(data, type);
                
                // Backdrop
                if (data.backdrop_path) {
                    document.getElementById('detailBackdrop').style.backgroundImage = 
                        `url(${BACKDROP_BASE}${data.backdrop_path})`;
                }
                
                // Poster
                const poster = document.getElementById('detailPoster');
                if (data.poster_path) {
                    poster.src = `${IMAGE_BASE}${data.poster_path}`;
                    poster.style.display = 'block';
                    poster.onerror = function() {
                        this.onerror = null;
                        this.style.background = 'linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)';
                        this.style.display = 'flex';
                        this.style.alignItems = 'center';
                        this.style.justifyContent = 'center';
                        this.innerHTML = '<span style="font-size:80px;opacity:0.7">ðŸŽ¬</span>';
                    };
                } else {
                    poster.src = '';
                    poster.style.display = 'block';
                    poster.style.background = 'linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)';
                    poster.style.display = 'flex';
                    poster.style.alignItems = 'center';
                    poster.style.justifyContent = 'center';
                    poster.innerHTML = '<span style="font-size:80px;opacity:0.7">ðŸŽ¬</span>';
                }
                
                // Title
                const title = data.title || data.name || 'Ä°simsiz';
                document.getElementById('detailTitle').textContent = title;
                
                // Meta info
                const meta = document.getElementById('detailMeta');
                const minutesText = window.languageManager ? window.languageManager.t('minutes') : 'dakika';
                const rating = data.vote_average ? (data.vote_average / 2).toFixed(1) : 'N/A';
                const releaseDate = data.release_date || data.first_air_date || 'Tarih bilgisi yok';
                const runtime = data.runtime || data.episode_run_time?.[0] || 0;
                
                meta.innerHTML = `
                    <div class="detail-meta-item">
                        <i class="fas fa-star"></i>
                        <span>${rating}</span>
                    </div>
                    <div class="detail-meta-item">
                        <i class="fas fa-calendar"></i>
                        <span>${releaseDate}</span>
                    </div>
                    ${runtime > 0 ? `
                    <div class="detail-meta-item">
                        <i class="fas fa-clock"></i>
                        <span>${runtime} ${minutesText}</span>
                              </div>
                    ` : ''}
                `;
                
                // Genres
                const genres = document.getElementById('detailGenres');
                if (data.genres && data.genres.length > 0) {
                    genres.innerHTML = data.genres.map(genre => 
                        `<span class="genre-badge">${genre.name}</span>`
                    ).join('');
                }
                
                // Description
                document.getElementById('detailDescription').textContent = 
                    data.overview || 'AÃ§Ä±klama bulunamadÄ±.';
                
                     } catch (error) {
                console.error('Film detay hatasÄ±:', error.message);
                document.getElementById('detailTitle').textContent = 'Film bilgileri yÃ¼klenemedi';
            }
        }

        async function getFilmfragman(movieId, type) {
            try {
                const apiLang = getApiLanguage();
                const response = await fetch(`${BASE_URL}/${type}/${movieId}/videos?api_key=${API_KEY}&language=${apiLang}`);
                if (!response.ok) {
                    throw new Error('Video bilgileri alÄ±namadÄ±.');
                }
                
                const data = await response.json();
                const videos = data.results || [];
                
                const trailer = videos.find(f => f.type === "Trailer" && f.site === "YouTube");
                const teaser = videos.find(f => f.type === "Teaser" && f.site === "YouTube");
                const anyVideo = videos.find(f => f.site === "YouTube");
                
                const videoKey = trailer?.key || teaser?.key || anyVideo?.key;
                const videoFrame = document.getElementById('videoFrame');
                const videoPlaceholder = document.getElementById('videoPlaceholder');
                const placeholderText = document.getElementById('videoPlaceholderText');
                
                if (videoKey) {
                    const videoTitle = trailer?.name || teaser?.name || anyVideo?.name || 'Video';
                    
                    // Validate video key format (should be 11 characters)
                    if (!videoKey || videoKey.length !== 11) {
                        console.error('Invalid YouTube video key:', videoKey);
                        videoFrame.style.display = 'none';
                        const invalidKeyText = window.languageManager ? window.languageManager.t('videoError') : 'GeÃ§ersiz video anahtarÄ±';
                        placeholderText.textContent = invalidKeyText;
                        videoPlaceholder.style.display = 'flex';
                        return;
                    }
                    
                    // YouTube embed URL with proper parameters to avoid error 153
                    // Using standard embed format recommended by YouTube
                    const embedUrl = `https://www.youtube.com/embed/${videoKey}?enablejsapi=1&origin=${encodeURIComponent(window.location.origin)}&rel=0&modestbranding=1&playsinline=1`;
                    
                    // Clear any existing src first to prevent conflicts
                    if (videoFrame.src) {
                        videoFrame.src = '';
                        // Wait for iframe to clear before setting new src
                        await new Promise(resolve => setTimeout(resolve, 50));
                    }
                    
                    // Set new src with error handling
                    try {
                        videoFrame.src = embedUrl;
                        videoFrame.title = videoTitle;
                        videoFrame.style.display = 'block';
                        videoPlaceholder.style.display = 'none';
                        
                        // Monitor iframe load - if it fails to load, show error after timeout
                        let loadTimeout = setTimeout(() => {
                            // Check if iframe is still trying to load after 5 seconds
                            // Note: Cross-origin restrictions prevent checking iframe content
                            // This is a fallback check
                        }, 5000);
                        
                        videoFrame.onload = () => {
                            clearTimeout(loadTimeout);
                        };
                    } catch (error) {
                        console.error('Error setting YouTube embed:', error);
                        videoFrame.style.display = 'none';
                        const errorText = window.languageManager ? window.languageManager.t('videoError') : 'Video yÃ¼klenirken hata oluÅŸtu';
                        placeholderText.textContent = errorText;
                        videoPlaceholder.style.display = 'flex';
                    }
                } else {
                    videoFrame.style.display = 'none';
                    const noVideoText = window.languageManager ? window.languageManager.t('noVideo') : 'Video bulunamadÄ±';
                    placeholderText.textContent = noVideoText;
                    videoPlaceholder.style.display = 'flex';
                }
            } catch (error) {
                console.error('Video yÃ¼kleme hatasÄ±:', error.message);
                document.getElementById('videoFrame').style.display = 'none';
                const placeholderText = document.getElementById('videoPlaceholderText');
                const errorText = window.languageManager ? window.languageManager.t('videoError') : 'Video yÃ¼klenirken hata oluÅŸtu';
                placeholderText.textContent = errorText;
                document.getElementById('videoPlaceholder').style.display = 'flex';
            }
        }

        async function getOyuncular(filmId, type) {
            try {
                if (!filmId || !type) {
                    throw new Error('Film ID veya tip bilgisi eksik');
                }
                
                const apiLang = getApiLanguage();
                const response = await fetch(`${BASE_URL}/${type}/${filmId}/credits?api_key=${API_KEY}&language=${apiLang}`);
                if (!response.ok) {
                    throw new Error(`Oyuncu bilgileri alÄ±namadÄ±: ${response.status}`);
                }
                
                const data = await response.json();
                const container = document.getElementById('castGrid');
                
                if (data.cast && data.cast.length > 0) {
                    container.innerHTML = '';
                    data.cast.slice(0, 20).forEach(actor => {
                        if (!actor || !actor.id) return;
                        
                        const card = document.createElement('div');
                        card.className = 'cast-card';
                        card.onclick = () => window.location.href = `/actor.html?actor=${actor.id}`;
                        
                        const profile = actor.profile_path 
                            ? `${IMAGE_BASE}${actor.profile_path}`
                            : '';
                        
                        card.innerHTML = `
                            <div class="cast-card-image-wrapper">
                                <img src="${profile}" alt="${actor.name}" loading="lazy" onerror="this.onerror=null; this.style.background='linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.innerHTML='<span style=\\'font-size:64px;opacity:0.6\\'>ðŸ‘¤</span>'">
                                           </div>
                            <div class="cast-card-info">
                                <div class="cast-card-name">${actor.name || 'Ä°simsiz'}</div>
                                <div class="cast-card-character">${actor.character || 'Karakter'}</div>
                                         </div>
                        `;
                        container.appendChild(card);
                        
                        // If no profile path, set placeholder manually
                        if (!actor.profile_path) {
                            const img = card.querySelector('img');
                            img.style.background = 'linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)';
                            img.style.display = 'flex';
                            img.style.alignItems = 'center';
                            img.style.justifyContent = 'center';
                            img.innerHTML = '<span style="font-size:64px;opacity:0.6">ðŸ‘¤</span>';
                        }
                    });
                } else {
                    container.innerHTML = '<p class="text-center text-muted">Oyuncu bilgisi bulunamadÄ±.</p>';
                }
            } catch (error) {
                console.error('Oyuncu yÃ¼kleme hatasÄ±:', error.message);
                document.getElementById('castGrid').innerHTML = '<p class="text-center text-muted">Oyuncular yÃ¼klenirken hata oluÅŸtu.</p>';
            }
        }

        async function getFilmImages(movieId, type) {
            try {
                if (!movieId || !type) {
                    throw new Error('Film ID veya tip bilgisi eksik');
                }
                
                const response = await fetch(`${BASE_URL}/${type}/${movieId}/images?api_key=${API_KEY}`);
                if (!response.ok) {
                    throw new Error(`GÃ¶rsel bilgileri alÄ±namadÄ±: ${response.status}`);
                }
                
                const data = await response.json();
                const container = document.getElementById('gallery');
                
                let images = data.backdrops || [];
                
                if (images.length === 0) {
                    container.innerHTML = '<p class="text-center text-muted">GÃ¶rsel bulunamadÄ±.</p>';
                    return;
                }
                
                images = images.slice(0, 20);
                container.innerHTML = '';
                
                images.forEach(image => {
                    if (!image.file_path) return;
                    
                    const img = document.createElement('img');
                    img.src = `${IMAGE_BASE}${image.file_path}`;
                    img.alt = image.title || 'GÃ¶rsel';
                    img.className = 'fancybox';
                    img.setAttribute('data-fancybox', 'gallery');
                    img.loading = 'lazy';
                    container.appendChild(img);
                });
                
                if (typeof $ !== 'undefined' && $.fn.fancybox) {
                    $('.fancybox').fancybox({
                        buttons: ['slideShow', 'fullScreen', 'thumbs', 'close'],
                        loop: false,
                        protect: true
                    });
                }
            } catch (error) {
                console.error('GÃ¶rsel yÃ¼kleme hatasÄ±:', error.message);
                document.getElementById('gallery').innerHTML = '<p class="text-center text-muted">GÃ¶rseller yÃ¼klenirken hata oluÅŸtu.</p>';
            }
        }

        async function getBenzerFilm(filmId, type) {
            try {
                if (!filmId || !type) {
                    throw new Error('Film ID veya tip bilgisi eksik');
                }
                
                const apiLang = getApiLanguage();
                // Use recommendations API instead of similar
                const response = await fetch(`${BASE_URL}/${type}/${filmId}/recommendations?api_key=${API_KEY}&language=${apiLang}`);
                if (!response.ok) {
                    throw new Error(`Ã–nerilen film bilgileri alÄ±namadÄ±: ${response.status}`);
                }
                
                const data = await response.json();
                const container = document.getElementById('similarMovies');
                
                if (data.results && data.results.length > 0) {
                    container.innerHTML = '';
                    data.results.slice(0, 20).forEach((movie, index) => {
                        if (!movie || !movie.id) return;
                        
                        const card = document.createElement('a');
                        card.className = 'movie-card';
                        const movieTitle = movie.title || movie.name || 'Ä°simsiz';
                        card.href = '/' + createDetailUrl(movie.id, type, movieTitle);
                        
                        const poster = movie.poster_path 
                            ? `${IMAGE_BASE}${movie.poster_path}`
                            : '';
                        
                        const rating = (movie.vote_average / 2).toFixed(1);
                        
                        card.innerHTML = `
                            <img src="${poster}" alt="${movieTitle}" loading="lazy" onerror="this.onerror=null; this.style.background='linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.innerHTML='<span style=\\'font-size:64px;opacity:0.7\\'>ðŸŽ¬</span>'">
                            <div class="movie-card-overlay">
                                <div class="movie-card-title">${movieTitle}</div>
                                <div class="movie-card-rating">
                                    <i class="fas fa-star"></i>
                                    <span>${rating}</span>
                                           </div>
                                         </div>
                        `;
                        container.appendChild(card);
                        
                        // If no poster path, set placeholder manually
                        if (!movie.poster_path) {
                            const img = card.querySelector('img');
                            img.style.background = 'linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)';
                            img.style.display = 'flex';
                            img.style.alignItems = 'center';
                            img.style.justifyContent = 'center';
                            img.innerHTML = '<span style="font-size:64px;opacity:0.7">ðŸŽ¬</span>';
                        }
                        
                        // Trigger animation with delay
                        setTimeout(() => {
                            card.classList.add('visible');
                        }, index * 50);
                    });
                           } else {
                    container.innerHTML = '<p class="text-center text-muted">Ã–nerilen film bulunamadÄ±.</p>';
                           }
                     } catch (error) {
                console.error('Ã–nerilen film yÃ¼kleme hatasÄ±:', error.message);
                document.getElementById('similarMovies').innerHTML = '<p class="text-center text-muted">Ã–nerilen filmler yÃ¼klenirken hata oluÅŸtu.</p>';
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            // Mobile Back Button
            const mobileBackButton = document.getElementById('mobileBackButton');
            if (mobileBackButton) {
                mobileBackButton.addEventListener('click', () => {
                    // Try to go back, if no history, go to index
                    if (window.history.length > 1) {
                        window.history.back();
                    } else {
                        window.location.href = 'index.html';
                    }
                });
            }

            const urlData = parseUrlForId();
            const movieId = urlData.id;
            const type = urlData.type;
            
            if (movieId) {
                getFilmDetails(movieId, type);
                getFilmfragman(movieId, type);
                getOyuncular(movieId, type);
                getFilmImages(movieId, type);
                getBenzerFilm(movieId, type);
            } else {
                document.getElementById('detailTitle').textContent = 'Film ID bulunamadÄ±';
            }
        });
      </script>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-left">
                <p class="footer-copyright">Â© 2025 Cine Search. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
            </div>
            <div class="footer-right">
                <span class="footer-developer">Developed by Fetih</span>
                <a href="https://github.com/FetihAkgun" target="_blank" rel="noopener noreferrer" class="footer-github">
                    <i class="fab fa-github"></i>
                    <span>GitHub</span>
                </a>
            </div>
        </div>
    </footer>
   </body>
</html>
