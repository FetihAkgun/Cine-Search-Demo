<!DOCTYPE html>
<html data-theme="dark" lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Permissions-Policy" content="autoplay=(self), encrypted-media=(self), accelerometer=(self), gyroscope=(self), picture-in-picture=(self), clipboard-write=(self), web-share=(self)"/>
    <meta name="referrer" content="strict-origin-when-cross-origin"/>
    <meta name="description" content="Film ve dizi arama. Cine Search'te istediÄŸiniz iÃ§eriÄŸi hÄ±zlÄ±ca bulun."/>
    <meta name="keywords" content="film arama, dizi arama, sinema arama"/>
    <meta name="robots" content="index, follow"/>
    <link rel="canonical" href="https://cinesearch.fetihakgun.com/search.html"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Cine Search - Arama SonuÃ§larÄ±"/>
    <meta property="og:description" content="Film ve dizi arama. Ä°stediÄŸiniz iÃ§eriÄŸi hÄ±zlÄ±ca bulun."/>
    <meta property="og:url" content="https://cinesearch.fetihakgun.com/search.html"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="/main.css" rel="stylesheet" type="text/css">
    <script src="/app.js" defer></script>
    <title>Cine Search - Arama SonuÃ§larÄ±</title>
</head>
<body>
    <nav class="navbar" id="mainNav">
        <div class="nav-container">
            <a class="navbar-brand" href="/index.html">
                <span class="brand-text">Cine Search</span>
            </a>
            <div class="navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html" data-translate="movies">Filmler</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/diziler.html" data-translate="series">Diziler</a>
                    </li>
                </ul>
                <div class="nav-controls">
                    <form action="/search.html" class="search-form">
                        <input class="form-control" type="search" name="query" data-translate-placeholder="searchPlaceholder" placeholder="Film Ara" aria-label="Search" id="desktopSearchInput"/>
                        <input type="hidden" name="page" value="1"/>
                        <input type="hidden" name="type" value="movie"/>
                        <button class="btn btn-outline-primary" type="submit" data-translate="search">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                    <button class="theme-toggle" type="button" title="Toggle Theme">
                        <i class="fas fa-moon theme-icon"></i>
                    </button>
                    <div class="language-selector">
                        <select>
                            <option value="tr">TR</option>
                            <option value="en">EN</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-bottom-nav">
        <div class="mobile-bottom-nav-items">
            <a href="/index.html" class="mobile-bottom-nav-item">
                <i class="fas fa-home"></i>
                <span data-translate="movies">Filmler</span>
            </a>
            <a href="/diziler.html" class="mobile-bottom-nav-item">
                <i class="fas fa-tv"></i>
                <span data-translate="series">Diziler</span>
            </a>
            <button class="mobile-bottom-nav-item mobile-nav-control" type="button" id="mobileSearchButton">
                <i class="fas fa-search"></i>
                <span data-translate="search">Ara</span>
            </button>
            <button class="mobile-bottom-nav-item mobile-nav-control" type="button" id="mobileThemeToggle" title="Toggle Theme">
                <i class="fas fa-moon theme-icon"></i>
                <span data-translate="theme">Tema</span>
            </button>
            <div class="mobile-bottom-nav-item mobile-nav-control mobile-language-item">
                <div class="mobile-language-button" id="mobileLanguageButton">
                    <span id="mobileLanguageText">TR</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="mobile-language-dropdown" id="mobileLanguageDropdown">
                    <div class="mobile-language-option" data-lang="tr">TR</div>
                    <div class="mobile-language-option" data-lang="en">EN</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Search Modal -->
    <div class="mobile-search-modal" id="mobileSearchModal">
        <div class="mobile-search-overlay" id="mobileSearchOverlay"></div>
        <div class="mobile-search-container">
            <div class="mobile-search-header">
                <h3 data-translate="search">Ara</h3>
                <button class="mobile-search-close" id="mobileSearchClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form class="mobile-search-form" id="mobileSearchForm">
                <div class="mobile-search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="search" class="mobile-search-input" id="mobileSearchInput" data-translate-placeholder="searchPlaceholder" placeholder="Film Ara" autofocus/>
                </div>
                <div class="mobile-search-type-selector">
                    <label class="mobile-search-type-option">
                        <input type="radio" name="searchType" value="movie" checked/>
                        <span data-translate="movies">Filmler</span>
                    </label>
                    <label class="mobile-search-type-option">
                        <input type="radio" name="searchType" value="tv"/>
                        <span data-translate="series">Diziler</span>
                    </label>
                </div>
                <button type="submit" class="mobile-search-submit">
                    <i class="fas fa-search"></i>
                    <span data-translate="search">Ara</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Search Results Section -->
    <div class="content-section" style="margin-top: 70px;">
        <div class="content-row">
            <h2 class="row-title" id="searchTitle">Arama SonuÃ§larÄ±</h2>
            <div class="movies-list" id="movies-list">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
            </div>
        </div>
        <div class="f-pagination">
            <nav aria-label="Page">
                <ul class="pagination" id="pagination"></ul>
            </nav>
        </div>
    </div>

    <script>
        const API_KEY = '1b44088d28f43962ed16e614f60cbbd1';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';
        
        function createSlug(title) {
            if (!title) return '';
            return title
                .toLowerCase()
                .replace(/ÄŸ/g, 'g')
                .replace(/Ã¼/g, 'u')
                .replace(/ÅŸ/g, 's')
                .replace(/Ä±/g, 'i')
                .replace(/Ã¶/g, 'o')
                .replace(/Ã§/g, 'c')
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }
        
        function createDetailUrl(id, type, title) {
            const slug = createSlug(title);
            const typePath = type === 'movie' ? 'film' : 'dizi';
            return `${typePath}/${id}${slug ? '-' + slug : ''}`;
        }

        function getURLParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param) || '';
        }

        async function getResults(query, page = 1) {
            const type = getURLParam("type") || 'movie';
            const baseUrl = type === 'movie' 
                ? `${BASE_URL}/search/movie`
                : `${BASE_URL}/search/tv`;
            
            const apiLang = window.languageManager ? window.languageManager.getApiLanguage() : 'tr-TR';
            const queryParams = new URLSearchParams({
                api_key: API_KEY,
                query: query,
                page: page,
                language: apiLang,
                include_adult: true
            });

            const url = `${baseUrl}?${queryParams}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Network response was not ok.');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        function displayResults(data, query) {
            const container = document.getElementById('movies-list');
            const title = document.getElementById('searchTitle');
            
            if (!data || !data.results || data.results.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">Arama sonucu bulunamadÄ±.</p>';
                title.textContent = `"${query}" iÃ§in sonuÃ§ bulunamadÄ±`;
                return;
            }

            title.textContent = `"${query}" iÃ§in ${data.total_results} sonuÃ§`;
            
            container.innerHTML = '';
            container.style.display = 'grid';
            container.style.gridTemplateColumns = 'repeat(auto-fill, minmax(220px, 1fr))';
            container.style.gap = '25px';
            container.style.padding = '20px 0';

            const type = getURLParam("type") || 'movie';
            
            data.results.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                
                const title = item.title || item.name || 'Ä°simsiz';
                const overview = item.overview || 'AÃ§Ä±klama bulunamadÄ±.';
                const poster = item.poster_path ? `${IMAGE_BASE}${item.poster_path}` : '';
                const rating = item.vote_average ? (item.vote_average / 2).toFixed(1) : 'N/A';
                
                card.innerHTML = `
                    <img src="${poster}" alt="${title}" class="card-img-top" onerror="this.onerror=null; this.style.background='linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)'; this.style.display='flex'; this.style.alignItems='center'; this.style.justifyContent='center'; this.innerHTML='<span style=\\'font-size:64px;opacity:0.7\\'>ðŸŽ¬</span>'">
                    <a href="/${createDetailUrl(item.id, type, title)}">
                        <div class="overlay">
                            <h3>${title.length > 30 ? title.substring(0, 30) + '...' : title}</h3>
                            <p>${overview.length > 150 ? overview.substring(0, 150) + '...' : overview}</p>
                            <p><i class="fas fa-star" style="color: #ffd700;"></i> ${rating}</p>
                        </div>
                    </a>
                `;
                
                container.appendChild(card);
                
                if (!item.poster_path) {
                    const img = card.querySelector('img');
                    if (img) {
                        img.style.background = 'linear-gradient(135deg, #2563eb 0%, #0ea5e9 100%)';
                        img.style.display = 'flex';
                        img.style.alignItems = 'center';
                        img.style.justifyContent = 'center';
                        img.innerHTML = '<span style="font-size:64px;opacity:0.7">ðŸŽ¬</span>';
                    }
                }
                
                // Trigger animation with delay
                setTimeout(() => {
                    card.classList.add('visible');
                }, index * 30);
            });
        }

        function updatePagination(currentPage, totalPages, query, type) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            const maxPages = Math.min(totalPages, 500);
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(maxPages, currentPage + 2);
            
            // First page
            if (startPage > 1) {
                const li = document.createElement('li');
                li.className = 'page-item';
                const firstText = window.languageManager ? window.languageManager.t('first') : 'Ä°lk';
                li.innerHTML = `<a class="page-link" href="?query=${encodeURIComponent(query)}&type=${type}&page=1">${firstText}</a>`;
                pagination.appendChild(li);
            }
            
            // Page numbers
            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="?query=${encodeURIComponent(query)}&type=${type}&page=${i}">${i}</a>`;
                pagination.appendChild(li);
            }
            
            // Last page
            if (endPage < maxPages) {
                const li = document.createElement('li');
                li.className = 'page-item';
                const lastText = window.languageManager ? window.languageManager.t('last') : 'Son';
                li.innerHTML = `<a class="page-link" href="?query=${encodeURIComponent(query)}&type=${type}&page=${maxPages}">${lastText}</a>`;
                pagination.appendChild(li);
            }
        }

        async function loadSearchResults() {
            const query = getURLParam("query");
            const page = parseInt(getURLParam("page")) || 1;
            const type = getURLParam("type") || 'movie';
            
            if (!query) {
                const container = document.getElementById('movies-list');
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">LÃ¼tfen arama yapÄ±n.</p>';
                return;
            }

            const data = await getResults(query, page);
            if (data) {
                displayResults(data, query);
                updatePagination(page, data.total_pages, query, type);
            }
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            loadSearchResults();
            
            // Mobile menu toggle

            // Navbar scroll effect
            let lastScroll = 0;
            const navbar = document.getElementById('mainNav');
            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;
                if (currentScroll > 100) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
                lastScroll = currentScroll;
            });
        });

        // Reload content when language changes
        function reloadPageContent() {
            loadSearchResults();
        }

        window.addEventListener('languageChanged', reloadPageContent);
    </script>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-left">
                <p class="footer-copyright">Â© 2025 Cine Search. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
            </div>
            <div class="footer-right">
                <span class="footer-developer">Developed by Fetih</span>
                <a href="https://github.com/FetihAkgun" target="_blank" rel="noopener noreferrer" class="footer-github">
                    <i class="fab fa-github"></i>
                    <span>GitHub</span>
                </a>
            </div>
        </div>
    </footer>
</body>
</html>
